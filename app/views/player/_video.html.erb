<%# TODO: figure out how to programmatically set height with JavaScript, or something %>
<%# should match app/assets/stylesheets/application.scss %>
<video width="100%" height="270" class="mejs__player" controls>
  <% hls_id = "source-hls-#{index}" %>
  <% dash_id = "source-dash-#{index}" %>
  <source id="<%= hls_id %>" src="<%= track.hls_uri %>" type="<%= AV::Track::SOURCE_TYPE_HLS %>"/>
  <source id="<%= dash_id %>" src="<%= track.mpeg_dash_uri %>" type="<%= AV::Track::SOURCE_TYPE_MPEG_DASH %>"/>
  <%= javascript_tag do -%>
    // EZProxy shenanigans
    for (var src_id of ['#<%= hls_id %>', '#<%= dash_id %>']) {
       src_orig = $(src_id).attr('src');
       src_safe = src_orig.replace(/vm147-lib-berkeley-edu\.libproxy.*\.berkeley\.edu/, 'vm147.lib.berkeley.edu');
       $(src_id).attr('src', src_safe);
    }
  <% end -%>
</video>
